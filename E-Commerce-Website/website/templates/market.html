{% extends "base.html" %}

{% block title %}Antique Market Page{% endblock %}

{% block content %}
<head>
  <link rel="stylesheet" href="{{ url_for('static',filename='card_style.css') }}">
</head>

<body>
      
  <!-- Creating a table for sell/purchase items by the user. -->
  <div class="row" style="margin-top:20px margin-left:10px">
    <div class="col-8">
      <!--Content block - table creation for all the products created using the API -->
      <div class="container-xxl">
        <div class="card shadow bg-dark text-white-shadow">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h4 style="color:grey">Products Available Today</h4>
              <form class="form-inline">
                <input
                  class="form-control form-control-sm mr-2"
                  type="search"
                  placeholder="Searchâ€¦"
                  aria-label="Search Products">
                <button class="btn btn-outline-secondary btn-sm" type="submit">Go</button>
              </form>
            </div>

            <!-- Generating the COLUMNS HERE: -->
            <div class="table-responsive">
              <table class="table table-striped table-hover table-dark">
                <caption class="sr-only">List of products</caption>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Product</th>
                    <th>Barcode</th>
                    <th>Price</th>
                    <th>Description</th>
                    <th>Image</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>

                  <!-- Rows inside the table HERE: -->
                  {% for item in item_order %}
                  {% include 'includes/modal.html' %}
                  <tr>
                    <td>{{ item.id }}</td>
                    <td>{{ item.name }}</td>
                    <td>{{ item.barcode }}</td>
                    <td>${{ "%.2f"|format(item.price) }}</td>
                    <td>{{ item.description|truncate(100) }}</td>
                    <td>
                      <img
                        src="{{ item.img_url }}"
                        alt="{{ item.name }}"
                        class="img-fluid"
                        style="max-width: 50px;">
                    </td>
                    <td>
                      <!--Adding a modal for button press validation-->
                      <button type="button" class="btn btn-sm btn-info mb-3" data-toggle="modal" data-target="#mainModal-moreInfo-{{ item.id }}"
                      style="height: 1rem padding: 0.1rem font-size: 1rem line-height: 2rem">
                        More Info
                      </button>

                      <button type="button" class="btn btn-sm btn-success mb-3" data-toggle="modal" data-target="#purchaseModal-{{ item.id }}">
                        Purchase
                      </button>

                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>

          </div>
        </div>
      </div>
    </div>

  <!--Items purchased stored here -->
    <div class="col-12 col-md-4">
      <div class="d-flex justify-content-between align-items-center p-3 bg-dark rounded">
        Your Cart
      </div>
      <div class="card-body p-0">
          <div class="table-responsive">
            <!--Table creation here-->
            {%if owned_items %}
            <table id="historyTable" class="table table-bordered">
              <thead>
                <tr><th>ID<th>Product</th><th>Price</th><th>Date</th></tr>
              </thead>
              <tbody>
                <!-- Table rows go here-->
                {% for purchased_items in owned_items %}
                <tr>
                  <td>{{ purchased_items.id }}</td>
                  <td>{{ purchased_items.name }}</td>
                  <td>${{ purchased_items.price }}</td>
                  <td>{{ purchased_items.date.strftime("%Y-%m-%d %H:%M:%S") }}</td>
                </tr>

                <form method="POST">
                  {{ sell_form.hidden_tag() }}
                  <button type="button" class="btn btn-sm btn-success mb-3">
                    {{ sell_form.submit() }}
                  </button>
                </form>

                {% endfor %}
              </tbody>
            </table>
            {% else %}
              <br>
              <p>You don't own any items yet.</p>
            {% endif %}
          <!-- Table creation ends here-->
          </div>
        </div>
      </div>
    </div>

  <!-- End of first div tag-->  
  </div>
</body>

{% endblock %}